<div class="customer-layout">
  <!-- Fixed Top Bar -->
  <div class="fixed-top-bar">
    <div class="top-bar-left">
      <button class="hamburger-btn" (click)="sidebar.toggleSidebar()" [class.active]="!sidebar.isCollapsed">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
      <h1 class="app-title">Stitch</h1>
    </div>
    <div class="top-bar-actions">
      <button class="notification-btn" aria-label="View notifications">
        <span class="material-icons">notifications</span>
        <span class="badge" *ngIf="appointments.length > 0">{{ appointments.length }}</span>
      </button>
      <button class="book-appointment-btn" (click)="openBookingPopup()">
        <span class="material-icons">add</span>
        <span>Book Appointment</span>
      </button>
    </div>
  </div>

  <!-- Navigation Sidebar -->
  <app-shared-sidebar #sidebar [title]="'Stitch'" [navItems]="customerNavItems"></app-shared-sidebar>

  <!-- Main Content -->
  <div class="dashboard-container">
    <div class="top-bar">
      <div class="dashboard-header">
        <h1>Welcome, {{ currentUser?.fullName }}!</h1>
      </div>
    </div>

    <!-- Order Status Tracker -->
    <app-order-status 
      *ngIf="currentAppointment"
      [status]="currentAppointment.status"
      [deadline]="currentAppointment.deadline">
    </app-order-status>

    <!-- Notice Message -->
    <div class="notice-banner" *ngIf="currentAppointment && currentAppointment.status !== 'PENDING'">
      <span class="material-icons">lock</span>
      <div class="notice-content">
        <strong>Editing Restricted</strong>
        <p>Your appointment has been {{ currentAppointment.status.toLowerCase().replace('_', ' ') }}. You can no longer edit or cancel this appointment. For changes, please contact support.</p>
      </div>
    </div>

    <!-- My Appointments -->
    <app-my-appointments
      [appointments]="appointments"
      [loading]="loading"
      (cancel)="cancelAppointment($event)"
      (edit)="openEditPopup($event)">
    </app-my-appointments>
  </div>
</div>

<!-- Book Appointment Popup -->
<app-book-appointment-popup
  *ngIf="showBookingPopup"
  [editMode]="!!editingAppointment"
  [appointmentData]="editingAppointment"
  (close)="closeBookingPopup()"
  (success)="onBookingSuccess()">
</app-book-appointment-popup>
